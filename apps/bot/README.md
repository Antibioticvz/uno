# @uno/bot — Telegram Bot Service

UNO Lite bot — сервис на grammY, обеспечивающий игровую механику UNO Lite в Telegram. Он использует чистую доменную логику из пакета `@uno/core`, оборачивая её в интерфейс команд, inline-кнопок и уведомлений.

## Архитектура и зависимости

- **Framework:** grammY (long polling, без webhook).
- **Домен:** импортирует функции `createGame`, `joinGame`, `playCard`, `drawCard`, `passTurn`, `getPublicState` из `@uno/core`.
- **Управление комнатами:** собственный `RoomManager` хранит состояние в памяти контейнера Render.
- **Конфигурация:** `config.ts` валидирует переменные окружения через zod.
- **Тесты:** доменная логика покрыта Vitest в пакете `@uno/core`; для бота предусмотрено логическое разделение слоёв для интеграционного тестирования.

## Локальный запуск

```bash
npm run dev -w @uno/bot
```

Команда стартует long polling в watch-режиме. Для продакшн-сборки используйте:

```bash
npm run build -w @uno/bot
npm run start -w @uno/bot
```

## Переменные окружения

| Переменная    | Назначение                                                     |
| ------------- | -------------------------------------------------------------- |
| `BOT_TOKEN`   | Токен бота, полученный у [@BotFather](https://t.me/BotFather). |
| `WEB_APP_URL` | Необязательная ссылка на веб-панель для подсказок.             |

Все переменные валидируются при запуске. В случае некорректного токена сервис завершает работу с подсказкой в логах.

## Поведение и UX

- `/create`, `/join`, `/hand`, `/state`, `/leave` и inline-кнопки полностью покрывают жизненный цикл партии.
- После каждого действия игроки получают приватные и публичные уведомления, построенные на функциях форматирования из `render.ts`.
- Сервис устойчив к переинициализации: комнаты замыкаются внутри процесса; при рестарте контейнера Render требуется повторное создание комнаты.

## Деплой на Render

Blueprint `render.yaml` создаёт Node Web Service `uno-lite-telegram-bot` с командами:

- **Build:** `npm install --include=dev && npm run build -w @uno/core && npm run build -w @uno/bot`
- **Start:** `npm run start -w @uno/bot`

Перед запуском обязательно добавьте переменную `BOT_TOKEN` в разделе Environment.
